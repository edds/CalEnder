/**
  * CalEnder: A Datepicker for Ender
  * copyright Dustin Diaz @ded 2011 | License MIT
  * https://github.com/ded/calEnder
  */
!function(a){function d(a){return a%4===0&&a%100!==0||a%400===0}function e(a,b){return[31,d(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]}function f(a){return c.indexOf(a)+1}function g(d,e){var g=this,h=null;this.options={format:["year","month","day"],date:!1,startDate:!1,endDate:!1};for(h in e)this.options[h]=e[h];this.$input=a(d).first(),this.$calendar=a(b).appendTo("body"),this.$calendar.delegate("tbody td","mouseover",function(){a(this).closest("tbody").find("td:nth-child("+(this.cellIndex+1)+")").addClass("hover")}),a(document).bind("click",function(a){g.$calendar.removeClass("active")}),this.$calendar.bind("mousedown click",function(a){a.stopPropagation(),a.preventDefault()}),this.$calendar.delegate("tbody td","mouseout",function(){a(this).closest("tbody").find("td:nth-child("+(this.cellIndex+1)+")").removeClass("hover")}),this.$calendar.delegate("tbody td:not(.inactive):not(.invalid)","click.day",function(b){var c=a(this).html(),d={year:g.$calendar.find(".date-current-year").html(),month:f(g.$calendar.find(".date-current-month").html()),day:parseInt(c,10)<9?"0"+c:c},e=[],h=0;for(;h<3;h++)e.push(d[g.options.format[h]]);g.$input.val(e.join("-")),g.$calendar.removeClass("active")}),this.$calendar.delegate(".date-month-previous","click",function(a){var b=parseFloat(g.$calendar.find(".date-current-year").html()),d=f(g.$calendar.find(".date-current-month").html())-1;--d==-1&&--b&&(d=11),g.setDate(c[d]+" 1,"+b)}),this.$calendar.delegate(".date-month-next","click",function(b){var d=parseFloat(g.$calendar.find(".date-current-year").html()),e=f(a(".date-current-month").html());e==12&&++d&&(e=0),g.setDate(c[e]+" 1,"+d)}),this.setDate((this.options.date||new Date).toDateString())}var b="<div class='date'>  <table>    <thead>      <tr class='date-header'>        <th class='date-nav date-month-previous'>&#8227;</th>        <th colspan='5' class='date-month-year'>          <span class='date-current-month'></span>          <span class='date-current-year'></span></th>        <th class='date-nav date-month-next'>&#8227;</th>      </tr>      <tr class='date-daysofweek'>        <th>S</th>        <th>M</th>        <th>T</th>        <th>W</th>        <th>T</th>        <th>F</th>        <th>S</th>      </tr>    </thead>    <tbody class='date-days'></tbody>  </table></div>",c=["January","February","March","April","May","June","July","August","September","October","November","December"];g.prototype.setDate=function(b){var d=new Date(b),f=new Date(d.getFullYear(),d.getMonth(),1),g=f.getDay(),h=e(d.getMonth()?d.getFullYear():d.getFullYear()-1,d.getMonth()?d.getMonth()-1:d.getMonth()),i=[],j=1,k=0,l=h-g,m=e(d.getYear(),d.getMonth()),n=Math.floor((m+g-7)/7),o=0,p=new Date(d.getFullYear(),d.getMonth(),m),q=this.options.startDate>f&&this.options.startDate<p||this.options.endDate>p&&this.options.endDate<p,r={},s=this.options.startDate>f?this.options.startDate.getDate():1,t=this.options.endDate>p?this.options.endDate.getDate():m,u="";if(this.options.startDate&&this.options.endDate&&q)while(s<m)s<=t&&(r[s++]=!0);else if(!this.options.startDate||!this.options.endDate)while(s<m)r[s++]=!0;this.$calendar.find(".date-current-year,.date-current-month,tbody.date-days").empty(),this.$calendar.find(".date-current-year").html(d.getFullYear()),this.$calendar.find(".date-current-month").html(c[d.getMonth()]),i.push("<tr>");while(l<h)i.push('<td class="inactive">'+ ++l+"</td>");while(g<7)u=r[++k]?"":' class="invalid"',i.push("<td"+u+">"+k+"</td>"),g++;i.push("</tr>");for(;o<n;o++){i.push("<tr>");var v=0;while(v<7)u=r[++k]?"":' class="invalid"',i.push("<td"+u+">"+k+"</td>"),v++;i.push("</tr>")}if(k<m){i.push("<tr>"),o=0;var w=k+7,x=0;while(o<7)k<m?(u=r[++k]?"":' class="invalid"',i.push("<td"+u+">"+k+"</td>")):i.push('<td class="inactive">'+ ++x+"</td>"),o++;i.push("</tr>")}this.$calendar.find("tbody.date-days").append(i.join(""));var y=new Date;d.getMonth()==y.getMonth()&&d.getFullYear()==y.getFullYear()&&this.$calendar.find(".date tbody.date-days td").each(function(b){b.innerHTML==y.getDate()&&!a(b).hasClass("inactive")&&a(b).addClass("today")})},a.ender({calender:function(b){a(this).forEach(function(c){var d=a(c),e=d.offset(),f=new g(c,b);d.bind("focus click",function(a){a.stopPropagation(),f.$calendar.css({left:e.left,top:e.top+e.height}).addClass("active")}).bind("keydown",function(a){a.keyCode==9&&f.$calendar.removeClass("active")})})}},!0)}(ender)